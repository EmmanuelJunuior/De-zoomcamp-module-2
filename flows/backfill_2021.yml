id: backfill_2021
namespace: zoomcamp

description: Backfill Yellow and Green taxi data for 2021 (Janâ€“Jul)

tasks:
  - id: taxi_type_loop
    type: io.kestra.plugin.core.flow.ForEach
    values:
      - yellow
      - green
    tasks:
      - id: month_loop
        type: io.kestra.plugin.core.flow.ForEach
        values:
          - "01"
          - "02"
          - "03"
          - "04"
          - "05"
          - "06"
          - "07"
        tasks:
          - id: run_subflow
            type: io.kestra.plugin.core.flow.Subflow
            flowId: "{{ taskrun.value == 'yellow' ? 'yellow_taxi_flow' : 'green_taxi_flow' }}"
            namespace: zoomcamp
            inputs:
              taxi: "{{ taskrun.value }}"
              year: 2021
              month: "{{ parent.taskrun.value }}"
